name: CI

on:
    pull_request:
      branches:
        - '**'

jobs:

    micro_ros_platformio:
        runs-on: ubuntu-20.04
        container: ubuntu:20.04

        strategy:
          fail-fast: false
          matrix:
            platform: [teensy41, nanorp2040connect, portenta_h7_m7]

        steps:
        - uses: actions/checkout@v3
          with:
            path: repo
        - name: Install environment
          uses: ./repo/.github/actions/platformio-env
        - name: Build
          shell: bash
          run: |
            cd repo/ci/arduino_serial
            ls ~/.platformio
            pio run -e ${{ matrix.platform }}
