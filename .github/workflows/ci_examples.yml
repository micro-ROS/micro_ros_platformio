name: CI_Examples

on:
    pull_request:
      branches:
        - '**'

jobs:

    micro_ros_platformio:
        runs-on: ubuntu-20.04
        container: ubuntu:20.04

        strategy:
          fail-fast: false
          matrix:
            example: [addtwoints_service, publisher_ethernet, publisher_serial, publisher_wifi, reconnection_example, subscriber, subscriber_twist, time_sync]
        steps:
        - uses: actions/checkout@v3
          with:
            path: repo
        - name: Install environment
          uses: ./repo/.github/actions/platformio-env
        - name: Build examples
          shell: bash
          run: |
            export PATH=$PATH:~/.platformio/penv/bin
            cd repo/examples/${{ matrix.example }}
            pio run
        - name: Build multiple transport example
          shell: bash
          run: |
            export PATH=$PATH:~/.platformio/penv/bin
            cd repo/examples/custom_configuration
            pio run -e teensy41
            pio run -e teensy41_eth
            pio run -e esp32dev_wifi
            pio run -e nanorp2040connect_wifi